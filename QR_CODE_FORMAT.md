# 📱 QR Code Format for ESP32 Integration

## 🎯 QR Code Structure

The QR code generated by ESP32 should contain JSON data with the following structure:

```json
{
  "package_token": "demo_token_electronics_001",
  "esp32_data": {
    "temperature": 22.5,
    "humidity": 45.0,
    "tamper_status": "secure",
    "battery_level": 85,
    "shock_detected": false,
    "gps_location": "19.0760,72.8777",
    "timestamp": "2025-10-31T10:30:00"
  }
}
```

---

## 📋 Field Descriptions

### **Required Fields:**

| Field | Type | Description | Example |
|-------|------|-------------|---------|
| `package_token` | string | Unique package identifier | `"demo_token_electronics_001"` |
| `esp32_data` | object | Sensor readings from ESP32 | See below |

### **ESP32 Data Fields:**

| Field | Type | Description | Example |
|-------|------|-------------|---------|
| `temperature` | number | Temperature in Celsius | `22.5` |
| `humidity` | number | Humidity percentage | `45.0` |
| `tamper_status` | string | `"secure"` or `"tampered"` | `"secure"` |
| `battery_level` | number | Battery percentage | `85` |
| `shock_detected` | boolean | Shock sensor status | `false` |
| `gps_location` | string | GPS coordinates (lat,long) | `"19.0760,72.8777"` |
| `timestamp` | string | ISO timestamp of reading | `"2025-10-31T10:30:00"` |

---

## 🔧 ESP32 Implementation Example

### **Arduino/C++ Code:**

```cpp
#include <ArduinoJson.h>
#include <QRCodeGenerator.h>

void generateQRCode() {
  // Create JSON document
  StaticJsonDocument<512> doc;
  
  // Add package token
  doc["package_token"] = "demo_token_electronics_001";
  
  // Add ESP32 sensor data
  JsonObject esp32 = doc.createNestedObject("esp32_data");
  esp32["temperature"] = readTemperature();
  esp32["humidity"] = readHumidity();
  esp32["tamper_status"] = isTampered() ? "tampered" : "secure";
  esp32["battery_level"] = getBatteryLevel();
  esp32["shock_detected"] = isShockDetected();
  esp32["gps_location"] = getGPSLocation();
  esp32["timestamp"] = getCurrentTimestamp();
  
  // Serialize to string
  String qrData;
  serializeJson(doc, qrData);
  
  // Generate QR code
  generateQR(qrData);
}
```

---

## 🧪 Test QR Codes

### **Test 1: Normal Package (Secure)**
```json
{
  "package_token": "demo_token_electronics_001",
  "esp32_data": {
    "temperature": 22.5,
    "humidity": 45.0,
    "tamper_status": "secure",
    "battery_level": 85,
    "shock_detected": false,
    "gps_location": "19.0760,72.8777",
    "timestamp": "2025-10-31T10:30:00"
  }
}
```

### **Test 2: Tampered Package**
```json
{
  "package_token": "demo_token_tampered_003",
  "esp32_data": {
    "temperature": 45.2,
    "humidity": 65.0,
    "tamper_status": "tampered",
    "battery_level": 72,
    "shock_detected": true,
    "gps_location": "19.0760,72.8777",
    "timestamp": "2025-10-31T10:15:00"
  }
}
```

### **Test 3: Low Battery Warning**
```json
{
  "package_token": "demo_token_electronics_001",
  "esp32_data": {
    "temperature": 23.1,
    "humidity": 48.0,
    "tamper_status": "secure",
    "battery_level": 15,
    "shock_detected": false,
    "gps_location": "19.0760,72.8777",
    "timestamp": "2025-10-31T11:00:00"
  }
}
```

---

## 📱 How to Test in Frontend

### **Option 1: Paste JSON Directly**
1. Copy one of the test QR codes above
2. Paste into the "Package Token" field
3. Click "Scan"
4. Frontend will parse the JSON and display ESP32 data

### **Option 2: Simple Token (Manual Entry)**
1. Enter just the token: `demo_token_electronics_001`
2. Click "Scan"
3. Manually adjust ESP32 values
4. Click "Upload & Proceed"

---

## 🔄 Complete Flow

```
┌─────────────┐
│   ESP32     │
│  Hardware   │
└──────┬──────┘
       │
       │ Reads Sensors
       │
       ▼
┌─────────────┐
│  Generate   │
│  QR Code    │
│  with JSON  │
└──────┬──────┘
       │
       │ Display QR
       │
       ▼
┌─────────────┐
│  Logistics  │
│  Scans QR   │
└──────┬──────┘
       │
       │ Parse JSON
       │
       ▼
┌─────────────┐
│  Frontend   │
│  Shows Data │
└──────┬──────┘
       │
       │ Review
       │
       ▼
┌─────────────┐
│   Upload    │
│ to Database │
└─────────────┘
```

---

## 🚀 Integration Steps

### **For ESP32 Team:**
1. Install ArduinoJson library
2. Read all sensors
3. Create JSON structure as shown above
4. Generate QR code with JSON string
5. Display QR on screen/e-paper

### **For Testing:**
1. Use the test JSON strings above
2. Paste directly into scanner
3. Verify data displays correctly
4. Test upload functionality

---

## ⚠️ Important Notes

- QR code must be valid JSON
- `package_token` is required
- `esp32_data` is required
- All sensor fields should be present
- Timestamps should be ISO 8601 format
- GPS coordinates: latitude,longitude format

---

**Ready to integrate with ESP32!** 🎉
